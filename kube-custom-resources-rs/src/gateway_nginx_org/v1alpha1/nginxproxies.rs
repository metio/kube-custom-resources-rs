// WARNING: generated by kopium - manual changes will be overwritten
// kopium command: kopium --docs --filename=./crd-catalog/nginxinc/nginx-kubernetes-gateway/gateway.nginx.org/v1alpha1/nginxproxies.yaml --derive=Default --derive=PartialEq --smart-derive-elision
// kopium version: 0.20.1

#[allow(unused_imports)]
mod prelude {
    pub use kube::CustomResource;
    pub use serde::{Serialize, Deserialize};
}
use self::prelude::*;

/// Spec defines the desired state of the NginxProxy.
#[derive(CustomResource, Serialize, Deserialize, Clone, Debug, Default, PartialEq)]
#[kube(group = "gateway.nginx.org", version = "v1alpha1", kind = "NginxProxy", plural = "nginxproxies")]
#[kube(schema = "disabled")]
#[kube(derive="Default")]
#[kube(derive="PartialEq")]
pub struct NginxProxySpec {
    /// DisableHTTP2 defines if http2 should be disabled for all servers.
    /// Default is false, meaning http2 will be enabled for all servers.
    #[serde(default, skip_serializing_if = "Option::is_none", rename = "disableHTTP2")]
    pub disable_http2: Option<bool>,
    /// IPFamily specifies the IP family to be used by the NGINX.
    /// Default is "dual", meaning the server will use both IPv4 and IPv6.
    #[serde(default, skip_serializing_if = "Option::is_none", rename = "ipFamily")]
    pub ip_family: Option<NginxProxyIpFamily>,
    /// Telemetry specifies the OpenTelemetry configuration.
    #[serde(default, skip_serializing_if = "Option::is_none")]
    pub telemetry: Option<NginxProxyTelemetry>,
}

/// Spec defines the desired state of the NginxProxy.
#[derive(Serialize, Deserialize, Clone, Debug, PartialEq)]
pub enum NginxProxyIpFamily {
    #[serde(rename = "dual")]
    Dual,
    #[serde(rename = "ipv4")]
    Ipv4,
    #[serde(rename = "ipv6")]
    Ipv6,
}

/// Telemetry specifies the OpenTelemetry configuration.
#[derive(Serialize, Deserialize, Clone, Debug, Default, PartialEq)]
pub struct NginxProxyTelemetry {
    /// Exporter specifies OpenTelemetry export parameters.
    #[serde(default, skip_serializing_if = "Option::is_none")]
    pub exporter: Option<NginxProxyTelemetryExporter>,
    /// ServiceName is the "service.name" attribute of the OpenTelemetry resource.
    /// Default is 'ngf:<gateway-namespace>:<gateway-name>'. If a value is provided by the user,
    /// then the default becomes a prefix to that value.
    #[serde(default, skip_serializing_if = "Option::is_none", rename = "serviceName")]
    pub service_name: Option<String>,
    /// SpanAttributes are custom key/value attributes that are added to each span.
    #[serde(default, skip_serializing_if = "Option::is_none", rename = "spanAttributes")]
    pub span_attributes: Option<Vec<NginxProxyTelemetrySpanAttributes>>,
}

/// Exporter specifies OpenTelemetry export parameters.
#[derive(Serialize, Deserialize, Clone, Debug, Default, PartialEq)]
pub struct NginxProxyTelemetryExporter {
    /// BatchCount is the number of pending batches per worker, spans exceeding the limit are dropped.
    /// Default: https://nginx.org/en/docs/ngx_otel_module.html#otel_exporter
    #[serde(default, skip_serializing_if = "Option::is_none", rename = "batchCount")]
    pub batch_count: Option<i32>,
    /// BatchSize is the maximum number of spans to be sent in one batch per worker.
    /// Default: https://nginx.org/en/docs/ngx_otel_module.html#otel_exporter
    #[serde(default, skip_serializing_if = "Option::is_none", rename = "batchSize")]
    pub batch_size: Option<i32>,
    /// Endpoint is the address of OTLP/gRPC endpoint that will accept telemetry data.
    /// Format: alphanumeric hostname with optional http scheme and optional port.
    pub endpoint: String,
    /// Interval is the maximum interval between two exports.
    /// Default: https://nginx.org/en/docs/ngx_otel_module.html#otel_exporter
    #[serde(default, skip_serializing_if = "Option::is_none")]
    pub interval: Option<String>,
}

/// SpanAttribute is a key value pair to be added to a tracing span.
#[derive(Serialize, Deserialize, Clone, Debug, Default, PartialEq)]
pub struct NginxProxyTelemetrySpanAttributes {
    /// Key is the key for a span attribute.
    /// Format: must have all '"' escaped and must not contain any '$' or end with an unescaped '\'
    pub key: String,
    /// Value is the value for a span attribute.
    /// Format: must have all '"' escaped and must not contain any '$' or end with an unescaped '\'
    pub value: String,
}

