apiVersion: "apiextensions.k8s.io/v1"
kind: "CustomResourceDefinition"
metadata:
  annotations:
    api-approved.kubernetes.io: "unapproved, experimental v1alpha2 changes"
    controller-gen.kubebuilder.io/version: "v0.19.0"
  name: "buckets.objectstorage.k8s.io"
spec:
  group: "objectstorage.k8s.io"
  names:
    kind: "Bucket"
    listKind: "BucketList"
    plural: "buckets"
    singular: "bucket"
  scope: "Cluster"
  versions:
    - name: "v1alpha2"
      schema:
        openAPIV3Schema:
          description: "Bucket is the Schema for the buckets API"
          properties:
            apiVersion:
              description: "APIVersion defines the versioned schema of this representation of an object.\nServers should convert recognized schemas to the latest internal value, and\nmay reject unrecognized values.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources"
              type: "string"
            kind:
              description: "Kind is a string value representing the REST resource this object represents.\nServers may infer this from the endpoint the client submits requests to.\nCannot be updated.\nIn CamelCase.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds"
              type: "string"
            metadata:
              type: "object"
            spec:
              description: "spec defines the desired state of Bucket"
              properties:
                bucketClaim:
                  description: "bucketClaim references the BucketClaim that resulted in the creation of this Bucket.\nFor statically-provisioned buckets, set the namespace and name of the BucketClaim that is\nallowed to bind to this Bucket."
                  properties:
                    name:
                      description: "name is the name of the BucketClaim being referenced."
                      maxLength: 253
                      minLength: 1
                      type: "string"
                      x-kubernetes-validations:
                        - message: "name is immutable"
                          rule: "self == oldSelf"
                    namespace:
                      description: "namespace is the namespace of the BucketClaim being referenced."
                      maxLength: 253
                      minLength: 1
                      type: "string"
                      x-kubernetes-validations:
                        - message: "namespace is immutable"
                          rule: "self == oldSelf"
                    uid:
                      description: "uid is the UID of the BucketClaim being referenced."
                      type: "string"
                      x-kubernetes-validations:
                        - message: "uid is immutable once set"
                          rule: "oldSelf == '' || self == oldSelf"
                  required:
                    - "name"
                    - "namespace"
                  type: "object"
                  x-kubernetes-validations:
                    - message: "namespace cannot be removed once set"
                      rule: "!has(oldSelf.namespace) || has(self.namespace)"
                    - message: "uid cannot be removed once set"
                      rule: "!has(oldSelf.uid) || has(self.uid)"
                deletionPolicy:
                  description: "deletionPolicy determines whether a Bucket should be deleted when its bound BucketClaim is\ndeleted. This is mutable to allow Admins to change the policy after creation.\nPossible values:\n - Retain: keep both the Bucket object and the backend bucket\n - Delete: delete both the Bucket object and the backend bucket"
                  enum:
                    - "Retain"
                    - "Delete"
                  type: "string"
                driverName:
                  description: "driverName is the name of the driver that fulfills requests for this Bucket."
                  minLength: 1
                  type: "string"
                  x-kubernetes-validations:
                    - message: "driverName is immutable"
                      rule: "self == oldSelf"
                existingBucketID:
                  description: "existingBucketID is the unique identifier for an existing backend bucket known to the driver.\nUse driver documentation to determine how to set this value.\nThis field is used only for Bucket static provisioning.\nThis field will be empty when the Bucket is dynamically provisioned from a BucketClaim."
                  minLength: 1
                  type: "string"
                  x-kubernetes-validations:
                    - message: "existingBucketID is immutable"
                      rule: "self == oldSelf"
                parameters:
                  additionalProperties:
                    type: "string"
                  description: "parameters is an opaque map of driver-specific configuration items passed to the driver that\nfulfills requests for this Bucket."
                  type: "object"
                  x-kubernetes-validations:
                    - message: "parameters map is immutable"
                      rule: "self == oldSelf"
                protocols:
                  description: "protocols lists object store protocols that the provisioned Bucket must support.\nIf specified, COSI will verify that each item is advertised as supported by the driver."
                  items:
                    description: "ObjectProtocol represents an object protocol type."
                    enum:
                      - "S3"
                      - "Azure"
                      - "GCS"
                    type: "string"
                  type: "array"
                  x-kubernetes-list-type: "set"
                  x-kubernetes-validations:
                    - message: "protocols list is immutable"
                      rule: "self == oldSelf"
              required:
                - "bucketClaim"
                - "deletionPolicy"
                - "driverName"
              type: "object"
              x-kubernetes-validations:
                - message: "parameters map cannot be added or removed after creation"
                  rule: "has(oldSelf.parameters) == has(self.parameters)"
                - message: "protocols list cannot be added or removed after creation"
                  rule: "has(oldSelf.protocols) == has(self.protocols)"
                - message: "existingBucketID cannot be added or removed after creation"
                  rule: "has(oldSelf.existingBucketID) == has(self.existingBucketID)"
            status:
              description: "status defines the observed state of Bucket"
              properties:
                bucketID:
                  description: "bucketID is the unique identifier for the backend bucket known to the driver."
                  minLength: 1
                  type: "string"
                  x-kubernetes-validations:
                    - message: "boundBucketName is immutable once set"
                      rule: "self == oldSelf"
                bucketInfo:
                  additionalProperties:
                    type: "string"
                  description: "bucketInfo contains info about the bucket reported by the driver, rendered in the same\nCOSI_<PROTOCOL>_<KEY> format used for the BucketAccess Secret.\ne.g., COSI_S3_ENDPOINT, COSI_AZURE_STORAGE_ACCOUNT.\nThis should not contain any sensitive information."
                  type: "object"
                error:
                  description: "error holds the most recent error message, with a timestamp.\nThis is cleared when provisioning is successful."
                  properties:
                    message:
                      description: "message is a string detailing the encountered error.\nNOTE: message will be logged, and it should not contain sensitive information."
                      type: "string"
                    time:
                      description: "time is the timestamp when the error was encountered."
                      format: "date-time"
                      type: "string"
                  type: "object"
                protocols:
                  description: "protocols is the set of protocols the Bucket reports to support. BucketAccesses can request\naccess to this BucketClaim using any of the protocols reported here."
                  items:
                    description: "ObjectProtocol represents an object protocol type."
                    enum:
                      - "S3"
                      - "Azure"
                      - "GCS"
                    type: "string"
                  type: "array"
                  x-kubernetes-list-type: "set"
                readyToUse:
                  description: "readyToUse indicates that the bucket is ready for consumption by workloads."
                  type: "boolean"
              required:
                - "readyToUse"
              type: "object"
              x-kubernetes-validations:
                - message: "bucketID cannot be removed once set"
                  rule: "!has(oldSelf.bucketID) || has(self.bucketID)"
                - message: "protocols cannot be removed once set"
                  rule: "!has(oldSelf.protocols) || has(self.protocols)"
          required:
            - "spec"
          type: "object"
      served: true
      storage: true
      subresources:
        status: {}
